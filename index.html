function generateInvoicePDF(invoice) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const pageWidth = doc.internal.pageSize.getWidth();
  const pageHeight = doc.internal.pageSize.getHeight();

  const margin = 15;

  // OUTER BORDER
  doc.setDrawColor(0);
  doc.setLineWidth(1);
  doc.rect(margin, margin, pageWidth - margin * 2, pageHeight - margin * 2);

  let y = margin + 15;

  // HEADER
  doc.setFont("helvetica", "bold");
  doc.setFontSize(20);
  doc.text("INVOICE", pageWidth - margin - 5, y, { align: "right" });

  doc.setFontSize(12);
  doc.setFont("helvetica", "normal");

  y += 10;

  doc.text("Farrier Pro", margin + 5, y);
  y += 7;
  doc.text(`Invoice #: ${invoice.invoiceNumber}`, margin + 5, y);
  y += 7;
  doc.text(`Date: ${new Date().toLocaleDateString()}`, margin + 5, y);

  y += 15;

  // BILL TO
  doc.setFont("helvetica", "bold");
  doc.text("Bill To:", margin + 5, y);
  doc.setFont("helvetica", "normal");

  y += 7;
  doc.text(invoice.customerName || "", margin + 5, y);
  y += 7;
  if (invoice.customerEmail) {
    doc.text(invoice.customerEmail, margin + 5, y);
    y += 7;
  }
  if (invoice.customerPhone) {
    doc.text(invoice.customerPhone, margin + 5, y);
    y += 7;
  }

  y += 10;

  // TABLE HEADER LINE
  doc.line(margin + 5, y, pageWidth - margin - 5, y);
  y += 8;

  doc.setFont("helvetica", "bold");
  doc.text("Service", margin + 5, y);
  doc.text("Amount", pageWidth - margin - 5, y, { align: "right" });

  doc.setFont("helvetica", "normal");
  y += 5;
  doc.line(margin + 5, y, pageWidth - margin - 5, y);
  y += 10;

  // LINE ITEMS
  invoice.items.forEach(item => {
    const label = item.horseName
      ? `${item.description} (${item.horseName})`
      : item.description;

    doc.text(label, margin + 5, y);
    doc.text(`$${Number(item.amount).toFixed(2)}`, pageWidth - margin - 5, y, { align: "right" });

    y += 8;
  });

  y += 5;
  doc.line(margin + 5, y, pageWidth - margin - 5, y);
  y += 10;

  // TOTAL
  doc.setFont("helvetica", "bold");
  doc.text("Total:", pageWidth - margin - 50, y);
  doc.text(`$${Number(invoice.total).toFixed(2)}`, pageWidth - margin - 5, y, { align: "right" });

  // STATUS WATERMARK
  if (invoice.status && invoice.status !== "outstanding") {
    doc.setFontSize(60);
    doc.setTextColor(200, 200, 200);
    doc.text(invoice.status.toUpperCase(), pageWidth / 2, pageHeight / 2, {
      align: "center",
      angle: 45
    });
    doc.setTextColor(0, 0, 0);
  }

  doc.save(`${invoice.invoiceNumber}.pdf`);
}
